<!DOCTYPE html>
<html lang="en" data-theme="pastel">
<head>
  <meta charset="UTF-8">
  <title>Notifications | Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-base-100 min-h-screen flex">
  <!-- Main Content Wrapper (sidebar removed) -->
  <div id="mainContent" class="flex-1 w-full">
    <!-- Navbar -->
    <nav class="navbar bg-base-200 shadow-sm px-4 py-2 flex items-center justify-between sticky top-0 z-40">
      <span class="text-xl font-bold text-primary">Medicare Admin</span>
      <div class="flex items-center gap-4">
        <div class="indicator">
          <span class="indicator-item badge badge-warning">2</span>
          <button class="btn btn-ghost text-xl" title="Notifications">
            <i class="fa-solid fa-bell"></i>
          </button>
        </div>
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="avatar cursor-pointer">
            <div class="w-10 rounded-full border-2 border-primary">
              <img src="/client/assets/images/admin-avatar.jpg" alt="Admin Avatar" />
            </div>
          </label>
          <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-44">
            <li><a href="profile.html">Profile</a></li>
            <li><a href="/client/index.html">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Notification Form -->
    <div class="container mx-auto px-2 py-8">
      <div class="card bg-base-100 shadow-md p-6 mb-6 max-w-2xl mx-auto">
        <h2 class="text-xl font-bold text-primary mb-4">Create Notification</h2>
        <form id="notificationForm" class="flex flex-col gap-4">
          <input type="text" id="notifTitle" class="input input-bordered w-full" placeholder="Title" required />
          <textarea id="notifMsg" class="textarea textarea-bordered w-full" rows="3" placeholder="Message body..." required></textarea>
          <div class="flex gap-4 flex-wrap">
            <select id="notifAudience" class="select select-bordered w-48" required>
              <option value="All Users">All Users</option>
              <option value="Pharmacists Only">Pharmacists Only</option>
              <option value="Customers Only">Customers Only</option>
            </select>
            <select id="notifPriority" class="select select-bordered w-48" required>
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary w-full mt-2">Send Notification</button>
        </form>
      </div>

      <!-- Search & Filter -->
      <div class="flex flex-wrap gap-4 mb-4 items-center">
        <input type="text" id="searchNotif" class="input input-bordered w-60" placeholder="Search notifications..." />
        <select id="filterAudience" class="select select-bordered w-40">
          <option value="">All Audiences</option>
          <option value="All Users">All Users</option>
          <option value="Pharmacists Only">Pharmacists Only</option>
          <option value="Customers Only">Customers Only</option>
        </select>
        <select id="filterPriority" class="select select-bordered w-40">
          <option value="">All Priorities</option>
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
      </div>

      <!-- Notifications Table -->
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>Title</th>
              <th>Audience</th>
              <th>Priority</th>
              <th>Date Sent</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="notifTable">
            <!-- JS will render notifications here -->
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <div id="pagination" class="flex justify-center mt-8 gap-2"></div>
    </div>
  </div>

  <!-- Edit Notification Modal -->
  <dialog id="editNotifModal" class="modal">
    <form method="dialog" class="modal-box max-w-md animate-fadein">
      <h3 class="font-bold text-lg mb-2 text-primary">Edit Notification</h3>
      <div class="flex flex-col gap-4">
        <input type="text" id="editTitle" class="input input-bordered w-full" required />
        <textarea id="editMsg" class="textarea textarea-bordered w-full" rows="3" required></textarea>
        <select id="editAudience" class="select select-bordered w-full">
          <option value="All Users">All Users</option>
          <option value="Pharmacists Only">Pharmacists Only</option>
          <option value="Customers Only">Customers Only</option>
        </select>
        <select id="editPriority" class="select select-bordered w-full">
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
        <select id="editStatus" class="select select-bordered w-full">
          <option value="Active">Active</option>
          <option value="Archived">Archived</option>
          <option value="Draft">Draft</option>
        </select>
      </div>
      <div class="flex gap-4 mt-6 justify-end">
        <button type="button" id="saveEditNotifBtn" class="btn btn-primary">Save</button>
        <button type="button" id="cancelEditNotifBtn" class="btn btn-outline">Cancel</button>
      </div>
    </form>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Confirm Delete/Archive Modal -->
  <dialog id="confirmModal" class="modal">
    <form method="dialog" class="modal-box max-w-sm animate-fadein flex flex-col items-center">
      <span id="confirmIcon" class="text-4xl mb-2"></span>
      <h3 id="confirmTitle" class="font-bold text-lg mb-2"></h3>
      <p id="confirmMsg" class="mb-4"></p>
      <div class="flex gap-4 w-full justify-end">
        <button type="button" id="confirmYesBtn" class="btn btn-error">Yes</button>
        <button type="button" id="confirmNoBtn" class="btn btn-outline">No</button>
      </div>
    </form>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 z-50 hidden">
    <div id="toastMsg" class="alert shadow-lg transition-all duration-300"></div>
  </div>

  <script>
    // Dummy notifications data
    let notifications = [
      { title: "System Update", msg: "Checkout flow improved.", audience: "All Users", priority: "Medium", date: "2024-06-04", status: "Active" },
      { title: "Stock Alert", msg: "Amoxicillin running low.", audience: "Pharmacists Only", priority: "High", date: "2024-06-03", status: "Active" },
      { title: "Promo", msg: "Get 10% off vitamins!", audience: "Customers Only", priority: "Low", date: "2024-06-02", status: "Archived" }
    ];
    let filteredNotifs = notifications;
    const pageSize = 4;
    let currentPage = 1;
    let editIdx = null;

    function getPriorityBadge(priority) {
      if (priority === "High") return '<span class="badge badge-error">High</span>';
      if (priority === "Medium") return '<span class="badge badge-warning">Medium</span>';
      return '<span class="badge badge-info">Low</span>';
    }
    function getStatusBadge(status) {
      if (status === "Active") return '<span class="badge badge-success">Active</span>';
      if (status === "Archived") return '<span class="badge badge-info">Archived</span>';
      return '<span class="badge badge-warning">Draft</span>';
    }

    function renderTable() {
      const tbody = document.getElementById('notifTable');
      tbody.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageNotifs = filteredNotifs.slice(start, end);

      pageNotifs.forEach((n, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${n.title}</td>
          <td>${n.audience}</td>
          <td>${getPriorityBadge(n.priority)}</td>
          <td>${n.date}</td>
          <td>${getStatusBadge(n.status)}</td>
          <td>
            <button class="btn btn-xs btn-outline btn-success edit-btn" data-idx="${idx}"><i class="fa-solid fa-pen"></i></button>
            <button class="btn btn-xs btn-outline btn-error delete-btn" data-idx="${idx}"><i class="fa-solid fa-trash"></i></button>
            <button class="btn btn-xs btn-outline btn-info archive-btn" data-idx="${idx}"><i class="fa-solid fa-box-archive"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Edit button logic
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.onclick = function() {
          editIdx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          openEditNotifModal(editIdx);
        };
      });
      // Delete button logic
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = function() {
          editIdx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          openConfirmModal("Delete Notification", "Are you sure you want to delete this notification?", "âŒ", () => {
            notifications.splice(editIdx, 1);
            filterNotifs();
            closeConfirmModal();
            showToast("Notification deleted.", "alert-success");
          });
        };
      });
      // Archive button logic
      document.querySelectorAll('.archive-btn').forEach(btn => {
        btn.onclick = function() {
          editIdx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          openConfirmModal("Archive Notification", "Archive this notification?", "ðŸ“¦", () => {
            notifications[editIdx].status = "Archived";
            filterNotifs();
            closeConfirmModal();
            showToast("Notification archived.", "alert-info");
          });
        };
      });
    }

    function openEditNotifModal(idx) {
      const n = filteredNotifs[idx];
      document.getElementById('editTitle').value = n.title;
      document.getElementById('editMsg').value = n.msg;
      document.getElementById('editAudience').value = n.audience;
      document.getElementById('editPriority').value = n.priority;
      document.getElementById('editStatus').value = n.status;
      document.getElementById('editNotifModal').showModal();
    }
    document.getElementById('saveEditNotifBtn').onclick = function() {
      const n = filteredNotifs[editIdx];
      n.title = document.getElementById('editTitle').value;
      n.msg = document.getElementById('editMsg').value;
      n.audience = document.getElementById('editAudience').value;
      n.priority = document.getElementById('editPriority').value;
      n.status = document.getElementById('editStatus').value;
      document.getElementById('editNotifModal').close();
      filterNotifs();
      showToast("Notification updated.", "alert-success");
    };
    document.getElementById('cancelEditNotifBtn').onclick = function() {
      document.getElementById('editNotifModal').close();
    };

    // Confirm modal logic
    function openConfirmModal(title, msg, icon, onConfirm) {
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMsg').textContent = msg;
      document.getElementById('confirmIcon').textContent = icon;
      document.getElementById('confirmModal').showModal();
      document.getElementById('confirmYesBtn').onclick = onConfirm;
      document.getElementById('confirmNoBtn').onclick = closeConfirmModal;
    }
    function closeConfirmModal() {
      document.getElementById('confirmModal').close();
    }

    // Toast logic
    function showToast(msg, type = "alert-success") {
      const toast = document.getElementById('toast');
      const toastMsg = document.getElementById('toastMsg');
      toastMsg.textContent = msg;
      toastMsg.className = `alert shadow-lg transition-all duration-300 ${type}`;
      toast.classList.remove("hidden");
      toast.classList.add("animate-fadein");
      setTimeout(() => {
        toast.classList.add("hidden");
        toast.classList.remove("animate-fadein");
      }, 2000);
    }

    // Add notification logic
    document.getElementById('notificationForm').onsubmit = function(e) {
      e.preventDefault();
      const title = document.getElementById('notifTitle').value.trim();
      const msg = document.getElementById('notifMsg').value.trim();
      const audience = document.getElementById('notifAudience').value;
      const priority = document.getElementById('notifPriority').value;
      if (!title || !msg) return;
      notifications.unshift({
        title, msg, audience, priority,
        date: new Date().toISOString().slice(0, 10),
        status: "Active"
      });
      filterNotifs();
      showToast("Notification sent!", "alert-success");
      this.reset();
    };

    // Search/filter logic
    document.getElementById('searchNotif').addEventListener('input', filterNotifs);
    document.getElementById('filterAudience').addEventListener('change', filterNotifs);
    document.getElementById('filterPriority').addEventListener('change', filterNotifs);
    function filterNotifs() {
      const search = document.getElementById('searchNotif').value.trim().toLowerCase();
      const audience = document.getElementById('filterAudience').value;
      const priority = document.getElementById('filterPriority').value;
      filteredNotifs = notifications.filter(n =>
        (!search || n.title.toLowerCase().includes(search) || n.msg.toLowerCase().includes(search)) &&
        (!audience || n.audience === audience) &&
        (!priority || n.priority === priority)
      );
      currentPage = 1;
      renderTable();
      renderPagination();
    }

    // Pagination
    function renderPagination() {
      const pag = document.getElementById('pagination');
      pag.innerHTML = '';
      const totalPages = Math.ceil(filteredNotifs.length / pageSize);
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.className = `btn btn-outline btn-sm ${i === currentPage ? 'btn-active btn-primary' : ''}`;
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          renderTable();
          renderPagination();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        pag.appendChild(btn);
      }
    }

    // Initial render
    filterNotifs();
  </script>
</body>
</html>