<!DOCTYPE html>
<html lang="en" data-theme="pastel">
<head>
  <meta charset="UTF-8">
  <title>Manage Products | Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-base-100 min-h-screen flex">
  <!-- Sidebar Navigation -->
  <aside id="sidebar" class="fixed top-0 left-0 h-screen bg-base-200 shadow-lg flex flex-col transition-all duration-300 z-50 w-16 md:w-64">
    <div class="flex items-center justify-between px-2 py-4 border-b border-base-300">
      <button id="sidebarToggle" class="btn btn-ghost btn-sm">
        <i class="fa-solid fa-bars text-xl"></i>
      </button>
      <span class="ml-2 text-xl font-bold text-primary sidebar-label hidden md:inline">Admin</span>
    </div>
    <nav class="flex-1 flex flex-col gap-2 mt-4">
      <a href="dashboard.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Dashboard">
        <i class="fa-solid fa-gauge-high text-primary text-xl"></i>
        <span class="sidebar-label hidden md:inline">Dashboard</span>
      </a>
      <a href="manageUsers.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Users">
        <i class="fa-solid fa-users text-primary text-xl"></i>
        <span class="sidebar-label hidden md:inline">Users</span>
      </a>
      <a href="manageProducts.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Products">
        <i class="fa-solid fa-capsules text-primary text-xl"></i>
        <span class="sidebar-label hidden md:inline">Products</span>
      </a>
      <a href="orders.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Orders">
        <i class="fa-solid fa-clipboard-list text-primary text-xl"></i>
        <span class="sidebar-label hidden md:inline">Orders</span>
      </a>
      <a href="settings.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Settings">
        <i class="fa-solid fa-gear text-primary text-xl"></i>
        <span class="sidebar-label hidden md:inline">Settings</span>
      </a>
      <a href="/client/index.html" class="btn btn-ghost flex items-center gap-3 px-4 py-2 sidebar-link group" title="Logout">
        <i class="fa-solid fa-right-from-bracket text-error text-xl"></i>
        <span class="sidebar-label hidden md:inline text-error">Logout</span>
      </a>
    </nav>
  </aside>
  <!-- Main Content Wrapper -->
  <div id="mainContent" class="flex-1 ml-16 md:ml-64 transition-all duration-300">
    <!-- Navbar -->
    <nav class="navbar bg-base-200 shadow-sm px-4 py-2 flex items-center justify-between sticky top-0 z-40">
      <span class="text-xl font-bold text-primary">Medicare Admin</span>
      <div class="flex items-center gap-4">
        <div class="indicator">
          <span class="indicator-item badge badge-warning">2</span>
          <button class="btn btn-ghost text-xl" title="Notifications">
            <i class="fa-solid fa-bell"></i>
          </button>
        </div>
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="avatar cursor-pointer">
            <div class="w-10 rounded-full border-2 border-primary">
              <img src="/client/assets/images/admin-avatar.jpg" alt="Admin Avatar" />
            </div>
          </label>
          <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-44">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="settings.html">Settings</a></li>
            <li><a href="/client/index.html">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Section -->
    <div class="container mx-auto px-2 py-8">
      <!-- Summary Stats -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
        <div>
          <h1 class="text-3xl font-bold text-primary mb-1">Manage Products</h1>
          <p class="text-base text-gray-600">View, edit, and control all medicines in the catalog.</p>
        </div>
        <div class="flex gap-3 items-center">
          <span class="badge badge-info">Total: <span id="totalCount">0</span></span>
          <span class="badge badge-error">Out of Stock: <span id="outStockCount">0</span></span>
          <span class="badge badge-warning">Prescription: <span id="prescriptionCount">0</span></span>
          <button id="addProductBtn" class="btn btn-primary btn-sm"><i class="fa-solid fa-plus mr-2"></i>Add New Product</button>
        </div>
      </div>
      <div class="flex flex-wrap gap-4 mb-4 items-center">
        <input type="text" id="searchProduct" class="input input-bordered w-60" placeholder="Search by name or category" />
        <select id="categoryFilter" class="select select-bordered w-40">
          <option value="">All Categories</option>
          <option>Antibiotic</option>
          <option>Painkiller</option>
          <option>Antihistamine</option>
          <option>Vitamin</option>
          <option>Diabetes</option>
          <option>Blood Pressure</option>
        </select>
      </div>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th><input type="checkbox" id="bulkSelectAll" /></th>
              <th>Product ID</th>
              <th>Image</th>
              <th>Medicine Name</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Prescription</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productsTable">
            <!-- JS will render products here -->
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <div id="pagination" class="flex justify-center mt-8 gap-2"></div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <dialog id="editProductModal" class="modal">
    <form method="dialog" class="modal-box max-w-md animate-fadein">
      <h3 class="font-bold text-lg mb-2 text-primary">Edit Product</h3>
      <div class="flex flex-col gap-4">
        <input type="text" id="editName" class="input input-bordered w-full" placeholder="Medicine Name" required />
        <input type="text" id="editCategory" class="input input-bordered w-full" placeholder="Category" required />
        <input type="number" id="editPrice" class="input input-bordered w-full" min="0" placeholder="Price" required />
        <input type="number" id="editStock" class="input input-bordered w-full" min="0" placeholder="Stock Quantity" required />
        <select id="editPrescription" class="select select-bordered w-full">
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <select id="editStatus" class="select select-bordered w-full">
          <option value="Active">Active</option>
          <option value="Out of Stock">Out of Stock</option>
        </select>
      </div>
      <div class="flex gap-4 mt-6 justify-end">
        <button type="button" id="saveEditProductBtn" class="btn btn-primary">Save</button>
        <button type="button" id="cancelEditProductBtn" class="btn btn-outline">Cancel</button>
      </div>
    </form>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Add Product Modal -->
  <dialog id="addProductModal" class="modal">
    <form method="dialog" class="modal-box max-w-md animate-fadein">
      <h3 class="font-bold text-lg mb-2 text-primary">Add New Product</h3>
      <div class="flex flex-col gap-4">
        <input type="text" id="addName" class="input input-bordered w-full" placeholder="Medicine Name" required />
        <input type="text" id="addCategory" class="input input-bordered w-full" placeholder="Category" required />
        <input type="number" id="addPrice" class="input input-bordered w-full" min="0" placeholder="Price" required />
        <input type="number" id="addStock" class="input input-bordered w-full" min="0" placeholder="Stock Quantity" required />
        <select id="addPrescription" class="select select-bordered w-full">
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <select id="addStatus" class="select select-bordered w-full">
          <option value="Active">Active</option>
          <option value="Out of Stock">Out of Stock</option>
        </select>
      </div>
      <div class="flex gap-4 mt-6 justify-end">
        <button type="button" id="saveAddProductBtn" class="btn btn-primary">Add</button>
        <button type="button" id="cancelAddProductBtn" class="btn btn-outline">Cancel</button>
      </div>
    </form>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Confirm Delete Modal -->
  <dialog id="confirmModal" class="modal">
    <form method="dialog" class="modal-box max-w-sm animate-fadein flex flex-col items-center">
      <span id="confirmIcon" class="text-4xl mb-2"></span>
      <h3 id="confirmTitle" class="font-bold text-lg mb-2"></h3>
      <p id="confirmMsg" class="mb-4"></p>
      <div class="flex gap-4 w-full justify-end">
        <button type="button" id="confirmYesBtn" class="btn btn-error">Yes</button>
        <button type="button" id="confirmNoBtn" class="btn btn-outline">No</button>
      </div>
    </form>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <script>
    // Dummy products data
    let products = [
      { id: "PR1001", image: "/client/assets/images/paracetamol.jpg", name: "Paracetamol", category: "Painkiller", price: 120, stock: 12, prescription: "No", status: "Active" },
      { id: "PR1002", image: "/client/assets/images/amoxicillin.jpg", name: "Amoxicillin", category: "Antibiotic", price: 350, stock: 0, prescription: "Yes", status: "Out of Stock" },
      { id: "PR1003", image: "/client/assets/images/ibuprofen.jpg", name: "Ibuprofen", category: "Painkiller", price: 180, stock: 8, prescription: "No", status: "Active" },
      { id: "PR1004", image: "/client/assets/images/metformin.jpg", name: "Metformin", category: "Diabetes", price: 400, stock: 20, prescription: "Yes", status: "Active" },
      { id: "PR1005", image: "/client/assets/images/vitamin-c.jpg", name: "Vitamin C", category: "Vitamin", price: 80, stock: 30, prescription: "No", status: "Active" }
    ];
    let filteredProducts = products;
    const pageSize = 4;
    let currentPage = 1;
    let editIdx = null;
    let bulkSelected = [];

    function renderStats() {
      document.getElementById('totalCount').textContent = products.length;
      document.getElementById('outStockCount').textContent = products.filter(p => p.status === "Out of Stock").length;
      document.getElementById('prescriptionCount').textContent = products.filter(p => p.prescription === "Yes").length;
    }

    function renderTable() {
      const tbody = document.getElementById('productsTable');
      tbody.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageProducts = filteredProducts.slice(start, end);

      pageProducts.forEach((product, idx) => {
        const statusBadge = product.status === "Active"
          ? '<span class="badge badge-success">Active</span>'
          : '<span class="badge badge-error">Out of Stock</span>';
        const prescriptionBadge = product.prescription === "Yes"
          ? '<span class="badge badge-warning">Yes</span>'
          : '<span class="badge badge-info">No</span>';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" class="bulkSelect" data-idx="${idx}" /></td>
          <td>${product.id}</td>
          <td><img src="${product.image}" alt="${product.name}" class="w-12 h-12 rounded shadow" /></td>
          <td>${product.name}</td>
          <td>${product.category}</td>
          <td>KES ${product.price.toLocaleString()}</td>
          <td>${product.stock}</td>
          <td>${prescriptionBadge}</td>
          <td>${statusBadge}</td>
          <td>
            <button class="btn btn-xs btn-outline btn-success edit-btn" data-idx="${idx}"><i class="fa-solid fa-pen"></i></button>
            <button class="btn btn-xs btn-outline btn-error delete-btn" data-idx="${idx}"><i class="fa-solid fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Edit button logic
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.onclick = function() {
          editIdx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          openEditProductModal(editIdx);
        };
      });
      // Delete button logic
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = function() {
          editIdx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          openConfirmModal("Delete Product", "Are you sure you want to delete this product?", "âŒ", () => {
            products.splice(editIdx, 1);
            filterProducts();
            closeConfirmModal();
          });
        };
      });
      // Bulk select logic
      document.querySelectorAll('.bulkSelect').forEach(box => {
        box.onchange = function() {
          const idx = parseInt(this.getAttribute('data-idx')) + (currentPage - 1) * pageSize;
          if (this.checked) {
            if (!bulkSelected.includes(idx)) bulkSelected.push(idx);
          } else {
            bulkSelected = bulkSelected.filter(i => i !== idx);
          }
        };
      });
      document.getElementById('bulkSelectAll').onchange = function() {
        const checked = this.checked;
        document.querySelectorAll('.bulkSelect').forEach(box => {
          box.checked = checked;
          box.onchange();
        });
      };
    }

    function openEditProductModal(idx) {
      const product = filteredProducts[idx];
      document.getElementById('editName').value = product.name;
      document.getElementById('editCategory').value = product.category;
      document.getElementById('editPrice').value = product.price;
      document.getElementById('editStock').value = product.stock;
      document.getElementById('editPrescription').value = product.prescription;
      document.getElementById('editStatus').value = product.status;
      document.getElementById('editProductModal').showModal();
    }
    document.getElementById('saveEditProductBtn').onclick = function() {
      const product = filteredProducts[editIdx];
      product.name = document.getElementById('editName').value;
      product.category = document.getElementById('editCategory').value;
      product.price = parseInt(document.getElementById('editPrice').value);
      product.stock = parseInt(document.getElementById('editStock').value);
      product.prescription = document.getElementById('editPrescription').value;
      product.status = document.getElementById('editStatus').value;
      document.getElementById('editProductModal').close();
      filterProducts();
    };
    document.getElementById('cancelEditProductBtn').onclick = function() {
      document.getElementById('editProductModal').close();
    };

    // Add product modal logic
    document.getElementById('addProductBtn').onclick = function() {
      document.getElementById('addName').value = "";
      document.getElementById('addCategory').value = "";
      document.getElementById('addPrice').value = "";
      document.getElementById('addStock').value = "";
      document.getElementById('addPrescription').value = "No";
      document.getElementById('addStatus').value = "Active";
      document.getElementById('addProductModal').showModal();
    };
    document.getElementById('saveAddProductBtn').onclick = function() {
      const name = document.getElementById('addName').value;
      const category = document.getElementById('addCategory').value;
      const price = parseInt(document.getElementById('addPrice').value);
      const stock = parseInt(document.getElementById('addStock').value);
      const prescription = document.getElementById('addPrescription').value;
      const status = document.getElementById('addStatus').value;
      products.push({
        id: "PR" + (1000 + products.length + 1),
        image: "/client/assets/images/paracetamol.jpg",
        name, category, price, stock, prescription, status
      });
      document.getElementById('addProductModal').close();
      filterProducts();
    };
    document.getElementById('cancelAddProductBtn').onclick = function() {
      document.getElementById('addProductModal').close();
    };

    // Confirm modal logic
    function openConfirmModal(title, msg, icon, onConfirm) {
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMsg').textContent = msg;
      document.getElementById('confirmIcon').textContent = icon;
      document.getElementById('confirmModal').showModal();
      document.getElementById('confirmYesBtn').onclick = onConfirm;
      document.getElementById('confirmNoBtn').onclick = closeConfirmModal;
    }
    function closeConfirmModal() {
      document.getElementById('confirmModal').close();
    }

    // Search/filter logic
    document.getElementById('searchProduct').addEventListener('input', filterProducts);
    document.getElementById('categoryFilter').addEventListener('change', filterProducts);
    function filterProducts() {
      const search = document.getElementById('searchProduct').value.trim().toLowerCase();
      const cat = document.getElementById('categoryFilter').value;
      filteredProducts = products.filter(p =>
        (!search || p.name.toLowerCase().includes(search) || p.category.toLowerCase().includes(search)) &&
        (!cat || p.category === cat)
      );
      currentPage = 1;
      renderStats();
      renderTable();
      renderPagination();
    }

    // Pagination
    function renderPagination() {
      const pag = document.getElementById('pagination');
      pag.innerHTML = '';
      const totalPages = Math.ceil(filteredProducts.length / pageSize);
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.className = `btn btn-outline btn-sm ${i === currentPage ? 'btn-active btn-primary' : ''}`;
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          renderTable();
          renderPagination();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        pag.appendChild(btn);
      }
    }

    // Sidebar toggle logic
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const sidebarToggle = document.getElementById('sidebarToggle');
    sidebarToggle.addEventListener('click', function() {
      if (sidebar.classList.contains('md:w-64')) {
        sidebar.classList.remove('md:w-64');
        sidebar.classList.add('w-16');
        mainContent.classList.remove('md:ml-64');
        mainContent.classList.add('ml-16');
        document.querySelectorAll('.sidebar-label').forEach(el => el.classList.add('hidden'));
      } else {
        sidebar.classList.remove('w-16');
        sidebar.classList.add('md:w-64');
        mainContent.classList.remove('ml-16');
        mainContent.classList.add('md:ml-64');
        document.querySelectorAll('.sidebar-label').forEach(el => el.classList.remove('hidden'));
      }
    });

    // Initial render
    filterProducts();
  </script>
</body>
</html>